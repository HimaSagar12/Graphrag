
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DOT File Visualization</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #graph {
      border: 1px solid #ccc;
      padding: 10px;
      overflow: auto;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    #downloadBtn {
      margin-top: 10px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
</head>
<body>
  <h2>DOT File Visualizer</h2>
  <textarea id="dotInput">
digraph G {
  A -> B;
  B -> C;
  C -> A;
  A -> D;
}
  </textarea>
  <br>
  <button onclick="renderGraph()">Render Graph</button>
  <button id="downloadBtn" onclick="downloadImage()" disabled>Download as PNG</button>
  <div id="graph"></div>

  <script>
    let viz = new Viz();
    let lastSVG = null;

    function renderGraph() {
      const dot = document.getElementById('dotInput').value;
      viz.renderSVGElement(dot)
        .then(function(element) {
          const graphDiv = document.getElementById('graph');
          graphDiv.innerHTML = '';
          graphDiv.appendChild(element);
          lastSVG = element;
          document.getElementById('downloadBtn').disabled = false;
        })
        .catch(error => {
          viz = new Viz();
          alert("Error rendering graph. Check your DOT syntax.");
          document.getElementById('downloadBtn').disabled = true;
          console.error(error);
        });
    }

    function downloadImage() {
      if (!lastSVG) return;
      const svgData = new XMLSerializer().serializeToString(lastSVG);
      const svgBlob = new Blob([svgData], {type: "image/svg+xml;charset=utf-8"});
      const url = URL.createObjectURL(svgBlob);

      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);

        const pngUrl = canvas.toDataURL("image/png");
        const a = document.createElement('a');
        a.href = pngUrl;
        a.download = "graph.png";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      };
      img.src = url;
    }
  </script>
</body>
</html>
